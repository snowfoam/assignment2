{"remainingRequest":"C:\\Users\\lenovo\\Desktop\\chatapp\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\lenovo\\Desktop\\chatapp\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\lenovo\\Desktop\\chatapp\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\lenovo\\Desktop\\chatapp\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\lenovo\\Desktop\\chatapp\\src\\components\\Chat\\One.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\lenovo\\Desktop\\chatapp\\src\\components\\Chat\\One.vue","mtime":1576298763308},{"path":"C:\\Users\\lenovo\\Desktop\\chatapp\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\lenovo\\Desktop\\chatapp\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\lenovo\\Desktop\\chatapp\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\lenovo\\Desktop\\chatapp\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\lenovo\\Desktop\\chatapp\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3JzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmtleXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICJDOlxcVXNlcnNcXGxlbm92b1xcRGVza3RvcFxcY2hhdGFwcFxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkiOwoKZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7IHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTsgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpIHsgdmFyIHN5bWJvbHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCk7IGlmIChlbnVtZXJhYmxlT25seSkgc3ltYm9scyA9IHN5bWJvbHMuZmlsdGVyKGZ1bmN0aW9uIChzeW0pIHsgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqZWN0LCBzeW0pLmVudW1lcmFibGU7IH0pOyBrZXlzLnB1c2guYXBwbHkoa2V5cywgc3ltYm9scyk7IH0gcmV0dXJuIGtleXM7IH0KCmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9OyBpZiAoaSAlIDIpIHsgb3duS2V5cyhPYmplY3Qoc291cmNlKSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7IF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pOyB9KTsgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykgeyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKHNvdXJjZSkpOyB9IGVsc2UgeyBvd25LZXlzKE9iamVjdChzb3VyY2UpKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IHsgZ2V0TWVzc2FnZXMsIHNlbmRNZXNzYWdlIH0gZnJvbSAiQC9hcGkvY2hhdCI7CmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsKaW1wb3J0IEJTY3JvbGwgZnJvbSAiYmV0dGVyLXNjcm9sbCI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiY2hhdE9uZSIsCiAgZGF0YTogZnVuY3Rpb24gZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGZyb206IHRoaXMuJHJvdXRlLnBhcmFtcy5mcm9tLAogICAgICB0bzogdGhpcy4kcm91dGUucGFyYW1zLnRvLAogICAgICBtZXNzYWdlczogW10sCiAgICAgIHRpdGxlOiAiTG9hZGluZyIsCiAgICAgIGZyaWVuZDogIiIsCiAgICAgIG1lc3NhZ2U6ICIiLAogICAgICBzY3JvbGw6ICIiCiAgICB9OwogIH0sCiAgY3JlYXRlZDogZnVuY3Rpb24gY3JlYXRlZCgpIHsKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgdmFyIGZyb20gPSB0aGlzLiRyb3V0ZS5wYXJhbXMuZnJvbTsKICAgIHZhciB0byA9IHRoaXMuJHJvdXRlLnBhcmFtcy50bzsKICAgIHZhciBmcmllbmQgPSB0aGlzLiRyb3V0ZS5wYXJhbXMuZnJpZW5kOwogICAgdGhpcy50aXRsZSA9IGZyaWVuZC5uaWNrTmFtZTsKICAgIHRoaXMuZnJpZW5kID0gZnJpZW5kOwogICAgZ2V0TWVzc2FnZXMoewogICAgICBmcm9tOiBmcm9tLAogICAgICB0bzogdG8KICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICBfdGhpcy5tZXNzYWdlcyA9IHJlcy5kYXRhLmRhdGE7CgogICAgICBfdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzLnNjcm9sbCA9IG5ldyBCU2Nyb2xsKF90aGlzLiRyZWZzLndyYXBwZXIsIHt9KTsKCiAgICAgICAgX3RoaXMuc2Nyb2xsLnNjcm9sbFRvKDAsIF90aGlzLnNjcm9sbC5tYXhTY3JvbGxZKTsKICAgICAgfSk7CiAgICB9KTsKICB9LAogIGNvbXB1dGVkOiBfb2JqZWN0U3ByZWFkKHt9LCBtYXBHZXR0ZXJzKFsiX2lkIiwgInVzZXJJbmZvIl0pKSwKICBtZXRob2RzOiB7CiAgICBzZW5kOiBmdW5jdGlvbiBzZW5kKCkgewogICAgICB2YXIgX3RoaXMyID0gdGhpczsKCiAgICAgIGlmICh0aGlzLm1lc3NhZ2UgPT09ICcnKSByZXR1cm47CiAgICAgIHZhciBkYXRhID0gewogICAgICAgIG1lc3NhZ2U6IHRoaXMubWVzc2FnZSwKICAgICAgICB0bzogdGhpcy5mcmllbmQuX2lkLAogICAgICAgIGZyb206IHRoaXMuX2lkCiAgICAgIH07IC8vIOS8oOWIsOaVsOaNruW6kwoKICAgICAgc2VuZE1lc3NhZ2UoZGF0YSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgLy8g5Y+R6YCB57uZc29ja2V0CiAgICAgICAgX3RoaXMyLiRzb2NrZXQuZW1pdCgic2VuZFByaXZhdGVNZXNzYWdlIiwgZGF0YSk7IC8vIOi/memHjOiHquW3seS5n+imgeaYvuekugoKCiAgICAgICAgX3RoaXMyLm1lc3NhZ2VzLnB1c2goZGF0YSk7CgogICAgICAgIF90aGlzMi5tZXNzYWdlID0gJyc7CgogICAgICAgIF90aGlzMi4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgICAgaWYgKCFfdGhpczIuc2Nyb2xsKSB7CiAgICAgICAgICAgIF90aGlzMi5zY3JvbGwgPSBuZXcgQlNjcm9sbChfdGhpczIuJHJlZnMud3JhcHBlciwge30pOwoKICAgICAgICAgICAgX3RoaXMyLnNjcm9sbC5zY3JvbGxUbygwLCBfdGhpczIuc2Nyb2xsLm1heFNjcm9sbFkpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgX3RoaXMyLnNjcm9sbC5yZWZyZXNoKCk7CgogICAgICAgICAgICBfdGhpczIuc2Nyb2xsLnNjcm9sbFRvKDAsIF90aGlzMi5zY3JvbGwubWF4U2Nyb2xsWSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sCiAgc29ja2V0czogewogICAgcmVjZWl2ZVByaXZhdGVNZXNzYWdlOiBmdW5jdGlvbiByZWNlaXZlUHJpdmF0ZU1lc3NhZ2UoZGF0YSkgewogICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgIHRoaXMubWVzc2FnZXMucHVzaChkYXRhKTsKICAgICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgIGlmICghX3RoaXMzLnNjcm9sbCkgewogICAgICAgICAgX3RoaXMzLnNjcm9sbCA9IG5ldyBCU2Nyb2xsKF90aGlzMy4kcmVmcy53cmFwcGVyLCB7fSk7CgogICAgICAgICAgX3RoaXMzLnNjcm9sbC5zY3JvbGxUbygwLCBfdGhpczMuc2Nyb2xsLm1heFNjcm9sbFkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpczMuc2Nyb2xsLnJlZnJlc2goKTsKCiAgICAgICAgICBfdGhpczMuc2Nyb2xsLnNjcm9sbFRvKDAsIF90aGlzMy5zY3JvbGwubWF4U2Nyb2xsWSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9LAogIG1vdW50ZWQ6IGZ1bmN0aW9uIG1vdW50ZWQoKSB7fQp9Ow=="},{"version":3,"sources":["One.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <meta http-equiv=\"Access-Control-Allow-Origin\" content=\"*\">\r\n  <div>\r\n    <van-sticky>\r\n      <van-nav-bar :title=\"title\" left-arrow @click-left=\"$router.back()\" />\r\n    </van-sticky>\r\n    <div class=\"wrapper\" ref=\"wrapper\">\r\n      <ul>\r\n        <li id=\"myfriends\" v-for=\"(item,index) in messages\" :key=\"index\" :class=\"{'end': item.from === _id}\">\r\n          <div>\r\n            <van-image\r\n              id=\"friendavatar\"\r\n              fit=\"cover\"\r\n              round\r\n              width=\"40px\"\r\n              height=\"40px\"\r\n              :src=\"item.from === _id? userInfo.avatar: friend.avatar\"\r\n              slot=\"icon\"\r\n            />\r\n          </div>\r\n          <div class=\"chat\">\r\n            <p id=\"message\">{{item.message}}</p>\r\n          </div>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n    <div class=\"cell\">\r\n      <van-button id=\"sendbutton\" style=\"float:right;\" round type=\"info\" @click=\"send\">send</van-button>\r\n      <van-cell-group>\r\n        <van-field id=\"textarea\" v-model=\"message\" rows=\"1\" autosize type=\"textarea\" placeholder=\"请输入留言\" />\r\n      </van-cell-group>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { getMessages, sendMessage } from \"@/api/chat\";\r\nimport { mapGetters } from \"vuex\";\r\nimport BScroll from \"better-scroll\";\r\nexport default {\r\n  name: \"chatOne\",\r\n  data() {\r\n    return {\r\n      from: this.$route.params.from,\r\n      to: this.$route.params.to,\r\n      messages: [],\r\n      title: \"Loading\",\r\n      friend: \"\",\r\n      message: \"\",\r\n      scroll: \"\"\r\n    };\r\n  },\r\n  created() {\r\n    let from = this.$route.params.from;\r\n    let to = this.$route.params.to;\r\n    let friend = this.$route.params.friend;\r\n    this.title = friend.nickName;\r\n    this.friend = friend;\r\n    getMessages({ from, to }).then(res => {\r\n      this.messages = res.data.data;\r\n      this.$nextTick(() => {\r\n        this.scroll = new BScroll(this.$refs.wrapper, {});\r\n        this.scroll.scrollTo(0,this.scroll.maxScrollY)\r\n      });\r\n    });\r\n  },\r\n  computed: {\r\n    ...mapGetters([\"_id\",\"userInfo\"])\r\n  },\r\n  methods: {\r\n    send() {\r\n      if(this.message === '') return\r\n      let data = {\r\n        message: this.message,\r\n        to: this.friend._id,\r\n        from: this._id\r\n      };\r\n      // 传到数据库\r\n      sendMessage(data).then(res => {\r\n        // 发送给socket\r\n        this.$socket.emit(\"sendPrivateMessage\", data);\r\n        // 这里自己也要显示\r\n        this.messages.push(data);\r\n        this.message = ''\r\n        this.$nextTick(() => {\r\n          if (!this.scroll) {\r\n            this.scroll = new BScroll(this.$refs.wrapper, {});\r\n            this.scroll.scrollTo(0,this.scroll.maxScrollY)\r\n          } else {\r\n            this.scroll.refresh();\r\n            this.scroll.scrollTo(0,this.scroll.maxScrollY)\r\n          }\r\n        });\r\n      });\r\n    }\r\n  },\r\n  sockets: {\r\n    receivePrivateMessage(data) {\r\n      this.messages.push(data);\r\n      this.$nextTick(() => {\r\n        if (!this.scroll) {\r\n          this.scroll = new BScroll(this.$refs.wrapper, {});\r\n          this.scroll.scrollTo(0,this.scroll.maxScrollY)\r\n        } else {\r\n          this.scroll.refresh();\r\n          this.scroll.scrollTo(0,this.scroll.maxScrollY)\r\n        }\r\n      });\r\n    }\r\n  },\r\n\r\n  mounted() {}\r\n};\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.cell {\r\n  position: fixed;\r\n  bottom: 16px;\r\n  width: 100%;\r\n}\r\n.cell .van-cell {\r\n  width: 90%;\r\n  margin: auto;\r\n}\r\n.cell .van-cell-group {\r\n  width: 83%;\r\n  border-radius: 50px;\r\n  box-shadow: 0 5px 15px -5px rgba(0, 0, 0, 0.5);\r\n}\r\n.wrapper {\r\n  width: 100%;\r\n  height: 83vh;\r\n  overflow: hidden;\r\n  padding-top: 16px;\r\n  // margin-top: 30px;\r\n  // font-size: 16px;\r\n}\r\n.wrapper ul li {\r\n  display: flex;\r\n  margin-left: 10px;\r\n  line-height: 40px;\r\n}\r\n.chat {\r\n  font-size: 28px;\r\n  background: #fff;\r\n  box-shadow: 0 5px 15px -5px rgba(0, 0, 0, 0.5);\r\n  border-radius: 40px;\r\n  min-height: 40px;\r\n  margin-left: 16px;\r\n  padding: 0 16px;\r\n  margin-bottom: 16px;\r\n}\r\n.end {\r\n  flex-direction: row-reverse;\r\n  .chat {\r\n    margin-right: 16px;\r\n  }\r\n}\r\n</style>"],"sourceRoot":"src/components/Chat"}]}